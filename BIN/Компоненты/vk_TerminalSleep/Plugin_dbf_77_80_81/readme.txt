=============================================
Plugin_Terminal_Sleep
=============================================

(c) romix, 2006,2007

x-romix@mail.ru  icq 217099805


Исправление ошибки 100% загрузки процессора при ожидании блокировки в 
файл-серверных версиях 1С:Предприятие 7.7, 8.0 и 8.1.

Проверено на 1С:Предприятие 7.7 - 25 релиз,
1С:Предприятие 8.0 - версия 8.0.11.3
1C:Предприятие 8.1 - версия 8.1.8.76

Для клиент-серверной (SQL) версии 1С:Предприятие 7.7 нужно установить другой плагин
(vk_TerminalSleep), а для клиент-серверной версии 1С:Предприятие 8.x проблема неактуальна.


Описание проблемы


Если в многопользовательской базе 1С один из пользователей проводит документ, 
то другие пользователи не просто ждут, а нагружают процессор непрерывным запросом (что
особенно заметно в терминале). Это связано с тем, что разработчики 1С не поставили 
паузу sleep в цикл ожидания блокировки. 

Предлагаемое здесь решение вставляет (методом перехвата функций DLL) необходимую 
паузу sleep, и 1С в такой ситуации перестает потреблять ресурсы и непрерывно опрашивать сервер.

При последовательных неудачных попытках заблокировать файл, плагин вставляет нарастающие паузы 
длительностью 1,2,4,8,..1024 мс.

Чтобы узнать, актуальна ли эта проблема для Вашей версии 1С:Предприятие,
создайте пустую конфигурацию с документом, и вставьте в обработку проведения
Предупреждение (цель - приостановить проведение на неопределенное время).
Попытайтесь (в разделенном режиме работы) проводить один документ, и когда сработает Предупреждение, в это 
же время (из другой запущенной копии 1С:Предприятие) начните проводить другой документ.

Запустите диспетчер задач, и посмотрите, не потребляет ли ожидание блокировки
100% ресурсов процессора.

При установленном патче (или в тех версиях 1С:Предприятие, где эта ошибка не актуальна)
потребление ресурсов в этой же ситуации падает почти до нуля.



Установка 


Для начала Вам требуется установить загрузчик из папки PluginsLoader.
Способ установки указан в комплекте этого загрузчика в файле readme.txt.
Если ранее Вы уже устанавливали загрузчик, то устанавливать его повторно не нужно.

После этого скопируйте в папку bin\Plugins содержимое папки BIN настоящего дистрибутива.


Удаление

Закомментируйте или удалите в файле Hook_1C.ini строку, относящуюся к данному плагину.
